# Task ID: 28
# Title: Update Database Query Patterns for User Filtering
# Status: pending
# Dependencies: 22, 23
# Priority: high
# Description: Audit and update all database queries to ensure proper user/tenant filtering replaces the removed RLS policies
# Details:
Audit all database queries in src/app/api/**/route.ts files to ensure they include proper user filtering. Update secretsService methods to always include userId filters. Add userId validation to check_in_tokens and email_failures queries. Create query helper functions that automatically add user context. Ensure no queries can access data across user boundaries.

# Test Strategy:
Create database-query-audit.test.ts to verify all queries include proper user filtering. Test with multiple user contexts to ensure data isolation. Use database query logging to verify no unfiltered queries are executed.
